{% extends "base.html" %}

{% comment %}
 Set the name of the page 
{% endcomment %}
{% block page_title %}
Shopping Cart for {{ user.username }}
{% endblock page_title %}

{% comment %}
 Inject extra links into the page header
{% endcomment %}
{% block extra_head %}
{% endblock extra_head %}


{% comment %}
 CSS tag injection 
{% endblock css_inpage %}

{% comment %}
 Inject HTML for the content 
{% endcomment %}
{% block content %}
    <h2>Your Shopping Cart</h2>

    {% if cart_items %}
        {% for seller_id, items in cart_items.items %}
            <h3>Seller: {{ items.0.product.seller_id.username }}</h3> <!-- Mostrar el nombre del vendedor -->

            <table>
                <thead>
                    <tr>
                        <th>Product Name</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th>Subtotal</th>
                        <th>Remove</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in items %}
                    <tr>
                        <td>{{ item.product.name }}</td>
                        <td>{{ item.product.price }}</td>
                        <td>{{ item.quantity }}</td> 
                        <td>{{ item.subtotal }}</td>
                        <td>
                            <!-- Quantity Input -->
                            <input type="number" name="remove_quantity_{{ item.product.id }}" id="remove_quantity_{{ item.product.id }}" value="1" min="1" max="{{ item.quantity }}">
                            <!-- Remove from basket -->
                            <a href="#" id="removeLink_{{ item.product.id }}" class="btn btn-secondary">Remove</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endfor %}

        <div class="total-cost">
            <h3>Total: {{ total_cost }}</h3>
        </div>
    {% else %}
        <p>Your shopping cart is empty.</p>
    {% endif %}
{% endblock content %}
{% comment %}
 To the bottom of the body tag 
{% endcomment %}
{% block extrabody %}
{% endblock extrabody %}


{% comment %}
 JS tag injection 
{% endcomment %}
{% block js_inpage %}
    {% for seller_id, items in cart_items.items %}
        {% for item in items %}
            document.getElementById('removeLink_{{ item.product.id }}').addEventListener('click', function(event) {
                event.preventDefault();
                var quantity = document.getElementById('remove_quantity_{{ item.product.id }}').value;
                var url = "{% url 'products:remove' item.product.id 1 %}".replace('1', quantity);
                window.location.href = url;
            });
        {% endfor %}
    {% endfor %}
{% endblock js_inpage %}